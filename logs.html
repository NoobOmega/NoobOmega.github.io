<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿— - noobomegaçš„åšå®¢</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">â† è¿”å›é¦–é¡µ</a>
        
        <div class="content-page">
            <h2>ğŸ“ æˆ‘çš„æ—¥å¿—</h2>
            
            <!-- æœç´¢å’Œç­›é€‰ -->
            <div class="toolbar">
                <input type="text" id="search-logs" placeholder="æœç´¢æ—¥å¿—..." class="search-box">
                <select id="filter-logs" class="filter-select">
                    <option value="all">å…¨éƒ¨æ—¥å¿—</option>
                    <option value="public">å…¬å¼€æ—¥å¿—</option>
                    <option value="private">ç§æœ‰æ—¥å¿—</option>
                </select>
            </div>
            
            <!-- å…¬å¼€æ—¥å¿—åŒºåŸŸ -->
            <div id="public-logs">
                <h3>æ—¥å¿—åˆ—è¡¨</h3>
                <div id="public-logs-list" class="logs-container"></div>
            </div>
            
            <!-- ç®¡ç†å‘˜åŠŸèƒ½åŒºåŸŸ -->
            <div id="admin-logs" style="display: none;">
                <h3>æ—¥å¿—ç®¡ç†</h3>
                <div class="admin-tools">
                    <button onclick="logsManager.showEditor()" class="btn btn-primary">æ–°å»ºæ—¥å¿—</button>
                    <button onclick="logsManager.exportData()" class="btn btn-secondary">å¯¼å‡ºæ—¥å¿—</button>
                    <button onclick="logsManager.importData()" class="btn btn-secondary">å¯¼å…¥æ—¥å¿—</button>
                </div>
                
                <!-- ç¼–è¾‘å™¨ -->
                <div id="editor-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <h4 id="editor-title">æ–°å»ºæ—¥å¿—</h4>
                        <form id="log-editor-form">
                            <input type="text" id="log-title" placeholder="æ—¥å¿—æ ‡é¢˜" required>
                            <textarea id="log-content" placeholder="æ—¥å¿—å†…å®¹..." rows="8" required></textarea>
                            <div class="form-options">
                                <label>
                                    <input type="checkbox" id="log-private"> ç§æœ‰æ—¥å¿—
                                </label>
                            </div>
                            <div class="form-buttons">
                                <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                                <button type="button" onclick="logsManager.hideEditor()" class="btn btn-secondary">å–æ¶ˆ</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div id="logs-management" class="management-grid"></div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/common.js"></script>
    <script src="js/storage.js"></script>
    <script>
        const logsManager = {
            currentEditId: null,
            
            init: function() {
                this.loadLogs();
                this.setupEventListeners();
                
                if (auth.isLoggedIn()) {
                    document.getElementById('admin-logs').style.display = 'block';
                }
            },
            
            setupEventListeners: function() {
                // æœç´¢åŠŸèƒ½
                document.getElementById('search-logs').addEventListener('input', (e) => {
                    this.searchLogs(e.target.value);
                });
                
                // ç­›é€‰åŠŸèƒ½
                document.getElementById('filter-logs').addEventListener('change', (e) => {
                    this.filterLogs(e.target.value);
                });
                
                // ç¼–è¾‘å™¨è¡¨å•
                document.getElementById('log-editor-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveLog();
                });
            },
            
            loadLogs: function() {
                this.displayPublicLogs();
                if (auth.isLoggedIn()) {
                    this.displayManagementInterface();
                }
            },
            
            displayPublicLogs: function() {
                const publicLogs = storage.getLogs().filter(log => !log.private);
                this.renderLogs(publicLogs, 'public-logs-list');
            },
            
            displayManagementInterface: function() {
                const allLogs = storage.getLogs();
                this.renderManagementLogs(allLogs);
            },
            
            renderLogs: function(logs, containerId) {
                const container = document.getElementById(containerId);
                
                if (logs.length === 0) {
                    container.innerHTML = '<div class="empty-state">æš‚æ— æ—¥å¿—</div>';
                    return;
                }
                
                container.innerHTML = logs.map(log => `
                    <div class="log-item" data-id="${log.id}">
                        <div class="log-header">
                            <h4>${this.escapeHtml(log.title)}</h4>
                            <span class="log-date">${new Date(log.date).toLocaleDateString()}</span>
                        </div>
                        <div class="log-content">${this.formatContent(log.content)}</div>
                        ${auth.isLoggedIn() ? `
                            <div class="log-actions">
                                <button onclick="logsManager.editLog('${log.id}')">ç¼–è¾‘</button>
                                <button onclick="logsManager.deleteLog('${log.id}')" class="danger">åˆ é™¤</button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            },
            
            showEditor: function(logId = null) {
                this.currentEditId = logId;
                const modal = document.getElementById('editor-modal');
                const title = document.getElementById('editor-title');
                const form = document.getElementById('log-editor-form');
                
                if (logId) {
                    title.textContent = 'ç¼–è¾‘æ—¥å¿—';
                    const log = storage.getLog(logId);
                    document.getElementById('log-title').value = log.title;
                    document.getElementById('log-content').value = log.content;
                    document.getElementById('log-private').checked = log.private;
                } else {
                    title.textContent = 'æ–°å»ºæ—¥å¿—';
                    form.reset();
                }
                
                modal.style.display = 'block';
            },
            
            hideEditor: function() {
                document.getElementById('editor-modal').style.display = 'none';
                this.currentEditId = null;
            },
            
            saveLog: function() {
                const title = document.getElementById('log-title').value.trim();
                const content = document.getElementById('log-content').value.trim();
                const isPrivate = document.getElementById('log-private').checked;
                
                if (!title || !content) {
                    alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹ï¼');
                    return;
                }
                
                const logData = {
                    id: this.currentEditId || 'log_' + Date.now(),
                    title,
                    content,
                    private: isPrivate,
                    date: new Date().toISOString(),
                    type: 'log'
                };
                
                if (this.currentEditId) {
                    storage.updateLog(this.currentEditId, logData);
                } else {
                    storage.addLog(logData);
                }
                
                this.hideEditor();
                this.loadLogs();
                alert('ä¿å­˜æˆåŠŸï¼');
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            logsManager.init();
        });
    </script>
</body>
</html>
