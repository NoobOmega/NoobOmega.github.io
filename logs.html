<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日志 - noobomega的博客</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">← 返回首页</a>
        
        <div class="content-page">
            <h2>📝 我的日志</h2>
            
            <!-- 搜索和筛选 -->
            <div class="toolbar">
                <input type="text" id="search-logs" placeholder="搜索日志..." class="search-box">
                <select id="filter-logs" class="filter-select">
                    <option value="all">全部日志</option>
                    <option value="public">公开日志</option>
                    <option value="private">私有日志</option>
                </select>
            </div>
            
            <!-- 公开日志区域 -->
            <div id="public-logs">
                <h3>日志列表</h3>
                <div id="public-logs-list" class="logs-container"></div>
            </div>
            
            <!-- 管理员功能区域 -->
            <div id="admin-logs" style="display: none;">
                <h3>日志管理</h3>
                <div class="admin-tools">
                    <button onclick="logsManager.showEditor()" class="btn btn-primary">新建日志</button>
                    <button onclick="logsManager.exportData()" class="btn btn-secondary">导出日志</button>
                    <button onclick="logsManager.importData()" class="btn btn-secondary">导入日志</button>
                </div>
                
                <!-- 编辑器 -->
                <div id="editor-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <h4 id="editor-title">新建日志</h4>
                        <form id="log-editor-form">
                            <input type="text" id="log-title" placeholder="日志标题" required>
                            <textarea id="log-content" placeholder="日志内容..." rows="8" required></textarea>
                            <div class="form-options">
                                <label>
                                    <input type="checkbox" id="log-private"> 私有日志
                                </label>
                            </div>
                            <div class="form-buttons">
                                <button type="submit" class="btn btn-primary">保存</button>
                                <button type="button" onclick="logsManager.hideEditor()" class="btn btn-secondary">取消</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div id="logs-management" class="management-grid"></div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/common.js"></script>
    <script src="js/storage.js"></script>
    <script>
        const logsManager = {
            currentEditId: null,
            
            init: function() {
                this.loadLogs();
                this.setupEventListeners();
                
                if (auth.isLoggedIn()) {
                    document.getElementById('admin-logs').style.display = 'block';
                }
            },
            
            setupEventListeners: function() {
                // 搜索功能
                document.getElementById('search-logs').addEventListener('input', (e) => {
                    this.searchLogs(e.target.value);
                });
                
                // 筛选功能
                document.getElementById('filter-logs').addEventListener('change', (e) => {
                    this.filterLogs(e.target.value);
                });
                
                // 编辑器表单
                document.getElementById('log-editor-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveLog();
                });
            },
            
            loadLogs: function() {
                this.displayPublicLogs();
                if (auth.isLoggedIn()) {
                    this.displayManagementInterface();
                }
            },
            
            displayPublicLogs: function() {
                const publicLogs = storage.getLogs().filter(log => !log.private);
                this.renderLogs(publicLogs, 'public-logs-list');
            },
            
            displayManagementInterface: function() {
                const allLogs = storage.getLogs();
                this.renderManagementLogs(allLogs);
            },
            
            renderLogs: function(logs, containerId) {
                const container = document.getElementById(containerId);
                
                if (logs.length === 0) {
                    container.innerHTML = '<div class="empty-state">暂无日志</div>';
                    return;
                }
                
                container.innerHTML = logs.map(log => `
                    <div class="log-item" data-id="${log.id}">
                        <div class="log-header">
                            <h4>${this.escapeHtml(log.title)}</h4>
                            <span class="log-date">${new Date(log.date).toLocaleDateString()}</span>
                        </div>
                        <div class="log-content">${this.formatContent(log.content)}</div>
                        ${auth.isLoggedIn() ? `
                            <div class="log-actions">
                                <button onclick="logsManager.editLog('${log.id}')">编辑</button>
                                <button onclick="logsManager.deleteLog('${log.id}')" class="danger">删除</button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            },
            
            showEditor: function(logId = null) {
                this.currentEditId = logId;
                const modal = document.getElementById('editor-modal');
                const title = document.getElementById('editor-title');
                const form = document.getElementById('log-editor-form');
                
                if (logId) {
                    title.textContent = '编辑日志';
                    const log = storage.getLog(logId);
                    document.getElementById('log-title').value = log.title;
                    document.getElementById('log-content').value = log.content;
                    document.getElementById('log-private').checked = log.private;
                } else {
                    title.textContent = '新建日志';
                    form.reset();
                }
                
                modal.style.display = 'block';
            },
            
            hideEditor: function() {
                document.getElementById('editor-modal').style.display = 'none';
                this.currentEditId = null;
            },
            
            saveLog: function() {
                const title = document.getElementById('log-title').value.trim();
                const content = document.getElementById('log-content').value.trim();
                const isPrivate = document.getElementById('log-private').checked;
                
                if (!title || !content) {
                    alert('请填写标题和内容！');
                    return;
                }
                
                const logData = {
                    id: this.currentEditId || 'log_' + Date.now(),
                    title,
                    content,
                    private: isPrivate,
                    date: new Date().toISOString(),
                    type: 'log'
                };
                
                if (this.currentEditId) {
                    storage.updateLog(this.currentEditId, logData);
                } else {
                    storage.addLog(logData);
                }
                
                this.hideEditor();
                this.loadLogs();
                alert('保存成功！');
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            logsManager.init();
        });
    </script>
</body>
</html>
